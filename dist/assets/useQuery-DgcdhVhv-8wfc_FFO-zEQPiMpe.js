import{T as M,L as wt,l as Rt,B as st,r as it,O as Ot,n as Ct,a as ut,b as C,C as rt,u as G,D as kt,_ as ct,x as dt,k as Mt,c as xt}from"./index-CkfK2x5R.js";var gt=t=>{throw TypeError(t)},at=(t,e,i)=>e.has(t)||gt("Cannot "+i),s=(t,e,i)=>(at(t,e,"read from private field"),i?i.call(t):e.get(t)),d=(t,e,i)=>e.has(t)?gt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),o=(t,e,i,n)=>(at(t,e,"write to private field"),e.set(t,i),i),u=(t,e,i)=>(at(t,e,"access private method"),i),v,r,z,y,_,L,W,E,$,q,P,I,D,U,B,l,A,N,X,Y,Z,V,tt,et,pt,ft,St=(ft=class extends Ct{constructor(t,e){super(),d(this,l),d(this,v),d(this,r),d(this,z),d(this,y),d(this,_),d(this,L),d(this,W),d(this,E),d(this,$),d(this,q),d(this,P),d(this,I),d(this,D),d(this,U),d(this,B,new Set),this.options=e,o(this,v,t),o(this,E,null),o(this,W,ut()),this.options.experimental_prefetchInRender||s(this,W).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(e)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(s(this,r).addObserver(this),yt(s(this,r),this.options)?u(this,l,A).call(this):this.updateResult(),u(this,l,Z).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return nt(s(this,r),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return nt(s(this,r),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,u(this,l,V).call(this),u(this,l,tt).call(this),s(this,r).removeObserver(this)}setOptions(t){const e=this.options,i=s(this,r);if(this.options=s(this,v).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof C(this.options.enabled,s(this,r))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");u(this,l,et).call(this),s(this,r).setOptions(this.options),e._defaulted&&!rt(this.options,e)&&s(this,v).getQueryCache().notify({type:"observerOptionsUpdated",query:s(this,r),observer:this});const n=this.hasListeners();n&&bt(s(this,r),i,this.options,e)&&u(this,l,A).call(this),this.updateResult(),n&&(s(this,r)!==i||C(this.options.enabled,s(this,r))!==C(e.enabled,s(this,r))||G(this.options.staleTime,s(this,r))!==G(e.staleTime,s(this,r)))&&u(this,l,N).call(this);const b=u(this,l,X).call(this);n&&(s(this,r)!==i||C(this.options.enabled,s(this,r))!==C(e.enabled,s(this,r))||b!==s(this,U))&&u(this,l,Y).call(this,b)}getOptimisticResult(t){const e=s(this,v).getQueryCache().build(s(this,v),t),i=this.createResult(e,t);return Et(this,i)&&(o(this,y,i),o(this,L,this.options),o(this,_,s(this,r).state)),i}getCurrentResult(){return s(this,y)}trackResult(t,e){return new Proxy(t,{get:(i,n)=>(this.trackProp(n),e==null||e(n),Reflect.get(i,n))})}trackProp(t){s(this,B).add(t)}getCurrentQuery(){return s(this,r)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=s(this,v).defaultQueryOptions(t),i=s(this,v).getQueryCache().build(s(this,v),e);return i.fetch().then(()=>this.createResult(i,e))}fetch(t){return u(this,l,A).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),s(this,y)))}createResult(t,e){var i;const n=s(this,r),b=this.options,p=s(this,y),x=s(this,_),k=s(this,L),g=t!==n?t.state:s(this,z),{state:Q}=t;let a={...Q},h=!1,c;if(e._optimisticResults){const R=this.hasListeners(),H=!R&&yt(t,e),T=R&&bt(t,n,e,b);(H||T)&&(a={...a,...kt(Q.data,t.options)}),e._optimisticResults==="isRestoring"&&(a.fetchStatus="idle")}let{error:f,errorUpdatedAt:m,status:w}=a;c=a.data;let S=!1;if(e.placeholderData!==void 0&&c===void 0&&w==="pending"){let R;p!=null&&p.isPlaceholderData&&e.placeholderData===(k==null?void 0:k.placeholderData)?(R=p.data,S=!0):R=typeof e.placeholderData=="function"?e.placeholderData((i=s(this,P))==null?void 0:i.state.data,s(this,P)):e.placeholderData,R!==void 0&&(w="success",c=ct(p==null?void 0:p.data,R,e),h=!0)}if(e.select&&c!==void 0&&!S)if(p&&c===(x==null?void 0:x.data)&&e.select===s(this,$))c=s(this,q);else try{o(this,$,e.select),c=e.select(c),c=ct(p==null?void 0:p.data,c,e),o(this,q,c),o(this,E,null)}catch(R){o(this,E,R)}s(this,E)&&(f=s(this,E),c=s(this,q),m=Date.now(),w="error");const F=a.fetchStatus==="fetching",J=w==="pending",K=w==="error",ot=J&&F,lt=c!==void 0,O={status:w,fetchStatus:a.fetchStatus,isPending:J,isSuccess:w==="success",isError:K,isInitialLoading:ot,isLoading:ot,data:c,dataUpdatedAt:a.dataUpdatedAt,error:f,errorUpdatedAt:m,failureCount:a.fetchFailureCount,failureReason:a.fetchFailureReason,errorUpdateCount:a.errorUpdateCount,isFetched:a.dataUpdateCount>0||a.errorUpdateCount>0,isFetchedAfterMount:a.dataUpdateCount>g.dataUpdateCount||a.errorUpdateCount>g.errorUpdateCount,isFetching:F,isRefetching:F&&!J,isLoadingError:K&&!lt,isPaused:a.fetchStatus==="paused",isPlaceholderData:h,isRefetchError:K&&lt,isStale:ht(t,e),refetch:this.refetch,promise:s(this,W)};if(this.options.experimental_prefetchInRender){const R=j=>{O.status==="error"?j.reject(O.error):O.data!==void 0&&j.resolve(O.data)},H=()=>{const j=o(this,W,O.promise=ut());R(j)},T=s(this,W);switch(T.status){case"pending":t.queryHash===n.queryHash&&R(T);break;case"fulfilled":(O.status==="error"||O.data!==T.value)&&H();break;case"rejected":(O.status!=="error"||O.error!==T.reason)&&H();break}}return O}updateResult(){const t=s(this,y),e=this.createResult(s(this,r),this.options);if(o(this,_,s(this,r).state),o(this,L,this.options),s(this,_).data!==void 0&&o(this,P,s(this,r)),rt(e,t))return;o(this,y,e);const i=()=>{if(!t)return!0;const{notifyOnChangeProps:n}=this.options,b=typeof n=="function"?n():n;if(b==="all"||!b&&!s(this,B).size)return!0;const p=new Set(b??s(this,B));return this.options.throwOnError&&p.add("error"),Object.keys(s(this,y)).some(x=>{const k=x;return s(this,y)[k]!==t[k]&&p.has(k)})};u(this,l,pt).call(this,{listeners:i()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&u(this,l,Z).call(this)}},v=new WeakMap,r=new WeakMap,z=new WeakMap,y=new WeakMap,_=new WeakMap,L=new WeakMap,W=new WeakMap,E=new WeakMap,$=new WeakMap,q=new WeakMap,P=new WeakMap,I=new WeakMap,D=new WeakMap,U=new WeakMap,B=new WeakMap,l=new WeakSet,A=function(t){u(this,l,et).call(this);let e=s(this,r).fetch(this.options,t);return t!=null&&t.throwOnError||(e=e.catch(st)),e},N=function(){u(this,l,V).call(this);const t=G(this.options.staleTime,s(this,r));if(it||s(this,y).isStale||!dt(t))return;const e=Mt(s(this,y).dataUpdatedAt,t)+1;o(this,I,setTimeout(()=>{s(this,y).isStale||this.updateResult()},e))},X=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(s(this,r)):this.options.refetchInterval)??!1},Y=function(t){u(this,l,tt).call(this),o(this,U,t),!(it||C(this.options.enabled,s(this,r))===!1||!dt(s(this,U))||s(this,U)===0)&&o(this,D,setInterval(()=>{(this.options.refetchIntervalInBackground||xt.isFocused())&&u(this,l,A).call(this)},s(this,U)))},Z=function(){u(this,l,N).call(this),u(this,l,Y).call(this,u(this,l,X).call(this))},V=function(){s(this,I)&&(clearTimeout(s(this,I)),o(this,I,void 0))},tt=function(){s(this,D)&&(clearInterval(s(this,D)),o(this,D,void 0))},et=function(){const t=s(this,v).getQueryCache().build(s(this,v),this.options);if(t===s(this,r))return;const e=s(this,r);o(this,r,t),o(this,z,t.state),this.hasListeners()&&(e==null||e.removeObserver(this),t.addObserver(this))},pt=function(t){Rt.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(s(this,y))}),s(this,v).getQueryCache().notify({query:s(this,r),type:"observerResultsUpdated"})})},ft);function Wt(t,e){return C(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function yt(t,e){return Wt(t,e)||t.state.data!==void 0&&nt(t,e,e.refetchOnMount)}function nt(t,e,i){if(C(e.enabled,t)!==!1){const n=typeof i=="function"?i(t):i;return n==="always"||n!==!1&&ht(t,e)}return!1}function bt(t,e,i,n){return(t!==e||C(n.enabled,t)===!1)&&(!i.suspense||t.state.status!=="error")&&ht(t,i)}function ht(t,e){return C(e.enabled,t)!==!1&&t.isStaleByTime(G(e.staleTime,t))}function Et(t,e){return!rt(t.getCurrentResult(),e)}var mt=M.createContext(!1),Ut=()=>M.useContext(mt);mt.Provider;function Qt(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var Tt=M.createContext(Qt()),_t=()=>M.useContext(Tt),It=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},Dt=t=>{M.useEffect(()=>{t.clearReset()},[t])},Ft=({result:t,errorResetBoundary:e,throwOnError:i,query:n,suspense:b})=>t.isError&&!e.isReset()&&!t.isFetching&&n&&(b&&t.data===void 0||Ot(i,[t.error,n])),Lt=t=>{const e=t.staleTime;t.suspense&&(t.staleTime=typeof e=="function"?(...i)=>Math.max(e(...i),1e3):Math.max(e??1e3,1e3),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3)))},qt=(t,e)=>t.isLoading&&t.isFetching&&!e,Pt=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,vt=(t,e,i)=>e.fetchOptimistic(t).catch(()=>{i.clearReset()});function Bt(t,e,i){var n,b,p,x,k;const g=wt(),Q=Ut(),a=_t(),h=g.defaultQueryOptions(t);(b=(n=g.getDefaultOptions().queries)==null?void 0:n._experimental_beforeQuery)==null||b.call(n,h),h._optimisticResults=Q?"isRestoring":"optimistic",Lt(h),It(h,a),Dt(a);const c=!g.getQueryCache().get(h.queryHash),[f]=M.useState(()=>new e(g,h)),m=f.getOptimisticResult(h),w=!Q&&t.subscribed!==!1;if(M.useSyncExternalStore(M.useCallback(S=>{const F=w?f.subscribe(Rt.batchCalls(S)):st;return f.updateResult(),F},[f,w]),()=>f.getCurrentResult(),()=>f.getCurrentResult()),M.useEffect(()=>{f.setOptions(h)},[h,f]),Pt(h,m))throw vt(h,f,a);if(Ft({result:m,errorResetBoundary:a,throwOnError:h.throwOnError,query:g.getQueryCache().get(h.queryHash),suspense:h.suspense}))throw m.error;if((x=(p=g.getDefaultOptions().queries)==null?void 0:p._experimental_afterQuery)==null||x.call(p,h,m),h.experimental_prefetchInRender&&!it&&qt(m,Q)){const S=c?vt(h,f,a):(k=g.getQueryCache().get(h.queryHash))==null?void 0:k.promise;S==null||S.catch(st).finally(()=>{f.updateResult()})}return h.notifyOnChangeProps?m:f.trackResult(m)}function Ht(t,e){return Bt(t,St)}export{Ht as B};
