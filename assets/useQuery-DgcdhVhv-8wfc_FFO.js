import{T as M,a as wt,b as Rt,c as st,i as it,C as Ct,r as Ot,P as ut,w as O,d as rt,e as V,R as kt,f as ct,y as dt,v as Mt,g as Pt}from"./index-4os2vz5Y.js";var gt=t=>{throw TypeError(t)},nt=(t,e,i)=>e.has(t)||gt("Cannot "+i),s=(t,e,i)=>(nt(t,e,"read from private field"),i?i.call(t):e.get(t)),d=(t,e,i)=>e.has(t)?gt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),o=(t,e,i,a)=>(nt(t,e,"write to private field"),e.set(t,i),i),u=(t,e,i)=>(nt(t,e,"access private method"),i),b,r,z,v,Q,D,x,S,K,q,L,_,F,U,A,l,H,J,X,N,Y,Z,tt,et,pt,ft,Wt=(ft=class extends Ot{constructor(t,e){super(),d(this,l),d(this,b),d(this,r),d(this,z),d(this,v),d(this,Q),d(this,D),d(this,x),d(this,S),d(this,K),d(this,q),d(this,L),d(this,_),d(this,F),d(this,U),d(this,A,new Set),this.options=e,o(this,b,t),o(this,S,null),o(this,x,ut()),this.options.experimental_prefetchInRender||s(this,x).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(e)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(s(this,r).addObserver(this),vt(s(this,r),this.options)?u(this,l,H).call(this):this.updateResult(),u(this,l,Y).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return at(s(this,r),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return at(s(this,r),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,u(this,l,Z).call(this),u(this,l,tt).call(this),s(this,r).removeObserver(this)}setOptions(t){const e=this.options,i=s(this,r);if(this.options=s(this,b).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof O(this.options.enabled,s(this,r))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");u(this,l,et).call(this),s(this,r).setOptions(this.options),e._defaulted&&!rt(this.options,e)&&s(this,b).getQueryCache().notify({type:"observerOptionsUpdated",query:s(this,r),observer:this});const a=this.hasListeners();a&&yt(s(this,r),i,this.options,e)&&u(this,l,H).call(this),this.updateResult(),a&&(s(this,r)!==i||O(this.options.enabled,s(this,r))!==O(e.enabled,s(this,r))||V(this.options.staleTime,s(this,r))!==V(e.staleTime,s(this,r)))&&u(this,l,J).call(this);const y=u(this,l,X).call(this);a&&(s(this,r)!==i||O(this.options.enabled,s(this,r))!==O(e.enabled,s(this,r))||y!==s(this,U))&&u(this,l,N).call(this,y)}getOptimisticResult(t){const e=s(this,b).getQueryCache().build(s(this,b),t),i=this.createResult(e,t);return St(this,i)&&(o(this,v,i),o(this,D,this.options),o(this,Q,s(this,r).state)),i}getCurrentResult(){return s(this,v)}trackResult(t,e){return new Proxy(t,{get:(i,a)=>(this.trackProp(a),e==null||e(a),Reflect.get(i,a))})}trackProp(t){s(this,A).add(t)}getCurrentQuery(){return s(this,r)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=s(this,b).defaultQueryOptions(t),i=s(this,b).getQueryCache().build(s(this,b),e);return i.fetch().then(()=>this.createResult(i,e))}fetch(t){return u(this,l,H).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),s(this,v)))}createResult(t,e){var i;const a=s(this,r),y=this.options,p=s(this,v),P=s(this,Q),k=s(this,D),g=t!==a?t.state:s(this,z),{state:E}=t;let n={...E},h=!1,c;if(e._optimisticResults){const R=this.hasListeners(),B=!R&&vt(t,e),T=R&&yt(t,a,e,y);(B||T)&&(n={...n,...kt(E.data,t.options)}),e._optimisticResults==="isRestoring"&&(n.fetchStatus="idle")}let{error:f,errorUpdatedAt:m,status:w}=n;c=n.data;let W=!1;if(e.placeholderData!==void 0&&c===void 0&&w==="pending"){let R;p!=null&&p.isPlaceholderData&&e.placeholderData===(k==null?void 0:k.placeholderData)?(R=p.data,W=!0):R=typeof e.placeholderData=="function"?e.placeholderData((i=s(this,L))==null?void 0:i.state.data,s(this,L)):e.placeholderData,R!==void 0&&(w="success",c=ct(p==null?void 0:p.data,R,e),h=!0)}if(e.select&&c!==void 0&&!W)if(p&&c===(P==null?void 0:P.data)&&e.select===s(this,K))c=s(this,q);else try{o(this,K,e.select),c=e.select(c),c=ct(p==null?void 0:p.data,c,e),o(this,q,c),o(this,S,null)}catch(R){o(this,S,R)}s(this,S)&&(f=s(this,S),c=s(this,q),m=Date.now(),w="error");const I=n.fetchStatus==="fetching",$=w==="pending",G=w==="error",ot=$&&I,lt=c!==void 0,C={status:w,fetchStatus:n.fetchStatus,isPending:$,isSuccess:w==="success",isError:G,isInitialLoading:ot,isLoading:ot,data:c,dataUpdatedAt:n.dataUpdatedAt,error:f,errorUpdatedAt:m,failureCount:n.fetchFailureCount,failureReason:n.fetchFailureReason,errorUpdateCount:n.errorUpdateCount,isFetched:n.dataUpdateCount>0||n.errorUpdateCount>0,isFetchedAfterMount:n.dataUpdateCount>g.dataUpdateCount||n.errorUpdateCount>g.errorUpdateCount,isFetching:I,isRefetching:I&&!$,isLoadingError:G&&!lt,isPaused:n.fetchStatus==="paused",isPlaceholderData:h,isRefetchError:G&&lt,isStale:ht(t,e),refetch:this.refetch,promise:s(this,x)};if(this.options.experimental_prefetchInRender){const R=j=>{C.status==="error"?j.reject(C.error):C.data!==void 0&&j.resolve(C.data)},B=()=>{const j=o(this,x,C.promise=ut());R(j)},T=s(this,x);switch(T.status){case"pending":t.queryHash===a.queryHash&&R(T);break;case"fulfilled":(C.status==="error"||C.data!==T.value)&&B();break;case"rejected":(C.status!=="error"||C.error!==T.reason)&&B();break}}return C}updateResult(){const t=s(this,v),e=this.createResult(s(this,r),this.options);if(o(this,Q,s(this,r).state),o(this,D,this.options),s(this,Q).data!==void 0&&o(this,L,s(this,r)),rt(e,t))return;o(this,v,e);const i=()=>{if(!t)return!0;const{notifyOnChangeProps:a}=this.options,y=typeof a=="function"?a():a;if(y==="all"||!y&&!s(this,A).size)return!0;const p=new Set(y??s(this,A));return this.options.throwOnError&&p.add("error"),Object.keys(s(this,v)).some(P=>{const k=P;return s(this,v)[k]!==t[k]&&p.has(k)})};u(this,l,pt).call(this,{listeners:i()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&u(this,l,Y).call(this)}},b=new WeakMap,r=new WeakMap,z=new WeakMap,v=new WeakMap,Q=new WeakMap,D=new WeakMap,x=new WeakMap,S=new WeakMap,K=new WeakMap,q=new WeakMap,L=new WeakMap,_=new WeakMap,F=new WeakMap,U=new WeakMap,A=new WeakMap,l=new WeakSet,H=function(t){u(this,l,et).call(this);let e=s(this,r).fetch(this.options,t);return t!=null&&t.throwOnError||(e=e.catch(st)),e},J=function(){u(this,l,Z).call(this);const t=V(this.options.staleTime,s(this,r));if(it||s(this,v).isStale||!dt(t))return;const e=Mt(s(this,v).dataUpdatedAt,t)+1;o(this,_,setTimeout(()=>{s(this,v).isStale||this.updateResult()},e))},X=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(s(this,r)):this.options.refetchInterval)??!1},N=function(t){u(this,l,tt).call(this),o(this,U,t),!(it||O(this.options.enabled,s(this,r))===!1||!dt(s(this,U))||s(this,U)===0)&&o(this,F,setInterval(()=>{(this.options.refetchIntervalInBackground||Pt.isFocused())&&u(this,l,H).call(this)},s(this,U)))},Y=function(){u(this,l,J).call(this),u(this,l,N).call(this,u(this,l,X).call(this))},Z=function(){s(this,_)&&(clearTimeout(s(this,_)),o(this,_,void 0))},tt=function(){s(this,F)&&(clearInterval(s(this,F)),o(this,F,void 0))},et=function(){const t=s(this,b).getQueryCache().build(s(this,b),this.options);if(t===s(this,r))return;const e=s(this,r);o(this,r,t),o(this,z,t.state),this.hasListeners()&&(e==null||e.removeObserver(this),t.addObserver(this))},pt=function(t){Rt.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(s(this,v))}),s(this,b).getQueryCache().notify({query:s(this,r),type:"observerResultsUpdated"})})},ft);function xt(t,e){return O(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function vt(t,e){return xt(t,e)||t.state.data!==void 0&&at(t,e,e.refetchOnMount)}function at(t,e,i){if(O(e.enabled,t)!==!1){const a=typeof i=="function"?i(t):i;return a==="always"||a!==!1&&ht(t,e)}return!1}function yt(t,e,i,a){return(t!==e||O(a.enabled,t)===!1)&&(!i.suspense||t.state.status!=="error")&&ht(t,i)}function ht(t,e){return O(e.enabled,t)!==!1&&t.isStaleByTime(V(e.staleTime,t))}function St(t,e){return!rt(t.getCurrentResult(),e)}var mt=M.createContext(!1),Ut=()=>M.useContext(mt);mt.Provider;function Et(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var Tt=M.createContext(Et()),Qt=()=>M.useContext(Tt),_t=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},Ft=t=>{M.useEffect(()=>{t.clearReset()},[t])},It=({result:t,errorResetBoundary:e,throwOnError:i,query:a,suspense:y})=>t.isError&&!e.isReset()&&!t.isFetching&&a&&(y&&t.data===void 0||Ct(i,[t.error,a])),Dt=t=>{const e=t.staleTime;t.suspense&&(t.staleTime=typeof e=="function"?(...i)=>Math.max(e(...i),1e3):Math.max(e??1e3,1e3),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3)))},qt=(t,e)=>t.isLoading&&t.isFetching&&!e,Lt=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,bt=(t,e,i)=>e.fetchOptimistic(t).catch(()=>{i.clearReset()});function At(t,e,i){var a,y,p,P,k;const g=wt(),E=Ut(),n=Qt(),h=g.defaultQueryOptions(t);(y=(a=g.getDefaultOptions().queries)==null?void 0:a._experimental_beforeQuery)==null||y.call(a,h),h._optimisticResults=E?"isRestoring":"optimistic",Dt(h),_t(h,n),Ft(n);const c=!g.getQueryCache().get(h.queryHash),[f]=M.useState(()=>new e(g,h)),m=f.getOptimisticResult(h),w=!E&&t.subscribed!==!1;if(M.useSyncExternalStore(M.useCallback(W=>{const I=w?f.subscribe(Rt.batchCalls(W)):st;return f.updateResult(),I},[f,w]),()=>f.getCurrentResult(),()=>f.getCurrentResult()),M.useEffect(()=>{f.setOptions(h)},[h,f]),Lt(h,m))throw bt(h,f,n);if(It({result:m,errorResetBoundary:n,throwOnError:h.throwOnError,query:g.getQueryCache().get(h.queryHash),suspense:h.suspense}))throw m.error;if((P=(p=g.getDefaultOptions().queries)==null?void 0:p._experimental_afterQuery)==null||P.call(p,h,m),h.experimental_prefetchInRender&&!it&&qt(m,E)){const W=c?bt(h,f,n):(k=g.getQueryCache().get(h.queryHash))==null?void 0:k.promise;W==null||W.catch(st).finally(()=>{f.updateResult()})}return h.notifyOnChangeProps?m:f.trackResult(m)}function Bt(t,e){return At(t,Wt)}export{Bt as K};
